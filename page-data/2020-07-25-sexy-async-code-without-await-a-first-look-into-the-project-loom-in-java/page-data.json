{"componentChunkName":"component---src-templates-blog-post-js","path":"/2020-07-25-sexy-async-code-without-await-a-first-look-into-the-project-loom-in-java/","result":{"data":{"site":{"siteMetadata":{"title":"Lukas Steinbrecher","author":"Lukas Steinbrecher"}},"markdownRemark":{"id":"7f41c201-edcc-5518-a45d-2cca981b1d2d","excerpt":"The Project Loom is a project of the JDK team to implement virtual (“green”) threads on the Java platform.\nIn the Java world the classic thread-per-request…","timeToRead":2,"html":"<p>The Project Loom is a project of the JDK team to implement virtual (“green”) threads on the Java platform.\nIn the Java world the classic thread-per-request model is still very common. In this model, a separate thread is started on a Web server for each incoming request to process the request. This “blocking” of the thread is done to “pretend” that an operation (e.g. reading a network socket) is synchronous. However, since operating system threads are relatively heavy, they are generally a limited resource and often the first bottleneck that prevents a machine from processing more requests per time unit.\nTo get around this bottleneck, non-blocking APIs are used which do not block the thread. In Node.JS or Vertx, an event loop execution model is used, which encapsulates the asynchrony of operations, which can now be managed directly by the consumer, via callbacks or futures. However, the Project-Loom developers choose a different approach: non-blocking APIs are encapsulated by existing (synchronous) Java APIs and made “virtual-thread-ready” by blocking the virtual threads until the desired operation is completed. Thus, the synchronicity of the call is simulated at the virtual thread level, just as the operating system does with blocking syscalls with “real” threads. The semantics of the interface remain the same and therefore no changes on the consumer side are necessary.</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b1c9c53061c3803c3df8fde133bc8758/0956a/virtual-thread-synchron.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin: 7vw 0; max-width: 1360px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 41.1957411957412%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABXUlEQVQoz02S2Y6DMAxF+fl+Uj+jT30ZzYgOLWHNBoSdqndsM1RFsgKJfe61Q7QsC9Z1xTiOqKpKomkaOO9hjMEjTVHV9X/OAE/7Sinc73cURYFhGLBtG57Pp6zRG0gHEgR21kIxiAoMCXAhA7I8F/jtdkNNa5IkCCFgnmcx0vf9AdzQ04ELHuNEh9rAOI/eGliVInkofMcJvn5+YX1LgEmEubbrOnm/Xq/IsuwD2AeEsRe3TtrKpL2cklisKPdRGKOl5cMZr9zq+XyW/XfLA9mdpgnLuuzALIdzTtpzjkBlSaNw0MYipXHw7Dj/cHg6nXC5XHbgwkBS4oSZvg2BGMjqLNYGKtY1rLYoKo04jgXItTw3dsgPX0zEBa/XS2CBDtsuwJKTrm3RUovcLr9zeN/sfwAJsjMWZCAzuH0WiMIw0a+h4LSGL+lW6SK8d3Kz4pgTKY6CI+aPPQYe+3+dkmBriIi3KQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <picture>\n        <source\n          srcset=\"/static/b1c9c53061c3803c3df8fde133bc8758/53e9f/virtual-thread-synchron.webp 340w,\n/static/b1c9c53061c3803c3df8fde133bc8758/0991f/virtual-thread-synchron.webp 680w,\n/static/b1c9c53061c3803c3df8fde133bc8758/9d77c/virtual-thread-synchron.webp 1360w,\n/static/b1c9c53061c3803c3df8fde133bc8758/27063/virtual-thread-synchron.webp 2040w,\n/static/b1c9c53061c3803c3df8fde133bc8758/2e210/virtual-thread-synchron.webp 2442w\"\n          sizes=\"(max-width: 1360px) 100vw, 1360px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/b1c9c53061c3803c3df8fde133bc8758/a2595/virtual-thread-synchron.png 340w,\n/static/b1c9c53061c3803c3df8fde133bc8758/2473e/virtual-thread-synchron.png 680w,\n/static/b1c9c53061c3803c3df8fde133bc8758/55534/virtual-thread-synchron.png 1360w,\n/static/b1c9c53061c3803c3df8fde133bc8758/0a656/virtual-thread-synchron.png 2040w,\n/static/b1c9c53061c3803c3df8fde133bc8758/0956a/virtual-thread-synchron.png 2442w\"\n          sizes=\"(max-width: 1360px) 100vw, 1360px\"\n          type=\"image/png\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n          src=\"/static/b1c9c53061c3803c3df8fde133bc8758/55534/virtual-thread-synchron.png\"\n          alt=\"Virtual threads to translate asynchronous APIs into synchronous ones\"\n          title=\"\"\n          src=\"/static/b1c9c53061c3803c3df8fde133bc8758/55534/virtual-thread-synchron.png\"\n        />\n      </picture>\n      </span>\n  </span>\n  \n  </a>\n    \n<em>Figure: Virtual threads to translate asynchronous APIs into synchronous ones</em></p>\n<p>How exactly is such a virtual thread implemented in Project Loom? A virtual thread is represented by a so-called continuation. This is a piece of sequential code that can suspend itself (e.g. when waiting for an external resource) and can be continued at a later time. These continuations are executed by the JVM on real operating system threads (“carrier threads”) in sequence using a (configurable) scheduler.\nAs a major advantage of virtual threads over the event loop approach, the JVM promises to take advantage of the modern and efficient world of non-blocking APIs without changing its familiar thread-per-request programming model, and ideally to benefit from these changes without code changes from existing code bases. Existing interfaces are not broken and the necessary changes happen “under the hood”.</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/cc2ad1179328172a133661e162b4c269/e35ae/socket-api-ready.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin: 7vw 0; max-width: 1360px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 49.03846153846154%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB1ElEQVQozz2SW7OiMBCE+f+/ax/27MNWbXkXBAyEcI3cBRV7Z4bjsWqKEDqfPT1x0iSGNhpZnn9XgaKySE0KrQ3Cq4K93TAOA5QKkBhD+wmyjLWlaE1iEJNWJwkcW+ao6xpN0yJNUxJmqJsGVVniRqDHY0bXdVQtsqpG148Ig0B01lqpgtYZne37Do4hR7bt8Xq9cLlcEJB4IDfzPMve+w0SDgLNbINxmuG6Lvb7Pbbb7U8dDgfk1KGTFRWJHpimSYDX61U+sLv7/U7ANwH7FVg16Ia7wBjAet/35Q94za4dzmy8TwIMCaaiWNYMWpYF/GPHbdsi/3bIhz8QBnqeJ52VFNPqcH7CGCNADlxrjYQCjuOYcs3EHQPLusU0ry17BGOQwOkZRRGKooCTEtB2o9Bz2uCDH0BDw2llIGvL7HB6PKEjhegaylPHCrEKcbOlRCTAgTKM6COHez6fpXa7neR0PB7lFnCOprzh+Vpw8DV+/T3hz8bD738uvjbkVtGUh3FteX4udO/MD+B0OkkrDFZKrQ7JcUpDWWjqx8Bg40Y4+gnBE3pPcA4NbNPD0XQpA7q8YRhKwFwM4Qw/VdeNDMYPqVUaWnDx4HsufH5SBf76bkj7H2Zh55/kTBmbAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <picture>\n        <source\n          srcset=\"/static/cc2ad1179328172a133661e162b4c269/53e9f/socket-api-ready.webp 340w,\n/static/cc2ad1179328172a133661e162b4c269/0991f/socket-api-ready.webp 680w,\n/static/cc2ad1179328172a133661e162b4c269/9d77c/socket-api-ready.webp 1360w,\n/static/cc2ad1179328172a133661e162b4c269/27063/socket-api-ready.webp 2040w,\n/static/cc2ad1179328172a133661e162b4c269/f75c0/socket-api-ready.webp 2496w\"\n          sizes=\"(max-width: 1360px) 100vw, 1360px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/cc2ad1179328172a133661e162b4c269/a2595/socket-api-ready.png 340w,\n/static/cc2ad1179328172a133661e162b4c269/2473e/socket-api-ready.png 680w,\n/static/cc2ad1179328172a133661e162b4c269/55534/socket-api-ready.png 1360w,\n/static/cc2ad1179328172a133661e162b4c269/0a656/socket-api-ready.png 2040w,\n/static/cc2ad1179328172a133661e162b4c269/e35ae/socket-api-ready.png 2496w\"\n          sizes=\"(max-width: 1360px) 100vw, 1360px\"\n          type=\"image/png\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n          src=\"/static/cc2ad1179328172a133661e162b4c269/55534/socket-api-ready.png\"\n          alt=\"JEP 353: Preparation of the Socket API for virtual thread readiness\"\n          title=\"\"\n          src=\"/static/cc2ad1179328172a133661e162b4c269/55534/socket-api-ready.png\"\n        />\n      </picture>\n      </span>\n  </span>\n  \n  </a>\n    \n<em>Figure: JEP 353: Preparation of the Socket API for virtual thread readiness</em></p>\n<p>It is also not necessary, as for example in Javascript, to split its code into two worlds (synchronous/asynchronous) (the so-called Blue/Red-World problem).</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0af0204213ba3f73f630041ec277ac38/287bd/node.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin: 7vw 0; max-width: 1360px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 57.08263069139966%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAACRUlEQVQoz22STUsbQRjH996XfAAJaYQGAotK8JCYFwJBc2rVzbUUGr9CPkcvfoEmaw5C6Unb5OJdjFijVqw0rZdSU113s2/ztvN0ZqLU2M7yY3Z32N8+z39G29ncefTlZPf14Odgbfj7uv7rclgffP9RP+if1PcO+vXe56MJ5Ls7ev3jeu/w+M3+4fFa7/Do1YetT0+09bfrz3v7u3D69RTOzs7g/PwcwjCEEGFAhAK+BRGiZkKZIAKMMQS2A9fWDbieDxffLvjW+01dSzxLpBYXl4LqUpXPzc3RWq3GCCYsJCG78S3mhA5z0Yj52GcAXAB/4VxCxT0QjJ3ux21di8fjqUIhjyqVCgghX15e5pRSjgjitm/zUTDiHvK4j3xFgAMeRRHnXKhAESkhpW6n09W16enpVC6XQ+VyGTKZDF9dXQWqWkRgeRYIGQiRglAC0iTH2KgYCwnxOp2OriWTyVSpVEIC0HWdr6ysgKhQCS/tS3BDF0IcAmV0QnZPOimUFWazWZTP52FmZoYbhiEXIUABXLlXINoGJ3CUmEXsYXX/r3BhYQFVq1UQ4khsCheLnDAiMhtnJ1qVJfGx659xJ3SVMJFIpIrFospwdnZWtswZY2pTRIYcU3wrE1+K6058DyUUMXndbndcoaiMFAoFuSkgN0WeQzdwYWgPwfZsheVa4PiOikP8UOUskc9yBEHgb2+LYxOLxR6L7F6m0+na1NSUMT8/bzTfNQ1zwzSaraaiZbbU3N5oK0zTfEit3W6/aDQaT/8AZ++p5G9K1JcAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <picture>\n        <source\n          srcset=\"/static/0af0204213ba3f73f630041ec277ac38/53e9f/node.webp 340w,\n/static/0af0204213ba3f73f630041ec277ac38/0991f/node.webp 680w,\n/static/0af0204213ba3f73f630041ec277ac38/9d77c/node.webp 1360w,\n/static/0af0204213ba3f73f630041ec277ac38/27063/node.webp 2040w,\n/static/0af0204213ba3f73f630041ec277ac38/c9908/node.webp 2372w\"\n          sizes=\"(max-width: 1360px) 100vw, 1360px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/0af0204213ba3f73f630041ec277ac38/a2595/node.png 340w,\n/static/0af0204213ba3f73f630041ec277ac38/2473e/node.png 680w,\n/static/0af0204213ba3f73f630041ec277ac38/55534/node.png 1360w,\n/static/0af0204213ba3f73f630041ec277ac38/0a656/node.png 2040w,\n/static/0af0204213ba3f73f630041ec277ac38/287bd/node.png 2372w\"\n          sizes=\"(max-width: 1360px) 100vw, 1360px\"\n          type=\"image/png\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n          src=\"/static/0af0204213ba3f73f630041ec277ac38/55534/node.png\"\n          alt=\"Symptom of the Blue/Red-World problem in node.js: The same functionality must be provided in both variants (synchronous/asynchronous)\"\n          title=\"\"\n          src=\"/static/0af0204213ba3f73f630041ec277ac38/55534/node.png\"\n        />\n      </picture>\n      </span>\n  </span>\n  \n  </a>\n    \n*Figure: Symptom of the Blue/Red-World problem in node.js: The same functionality must be provided in both variants (synchronous/asynchronous)</p>\n<p>Preview builds of Project Loom are available at [https://jdk.java.net/loom/]. At first glance you won’t see much change, because we try to reuse the existing thread APIs for virtual threads as much as possible.</p>\n<p>Ideally, the end user of a framework won’t notice much, but will benefit from it bit by bit when virtual thread support is arriving in frameworks and libraries. Whether it is really possible to reuse as much code without changes as the Project-Loom developers had in mind will become apparent over time.</p>","frontmatter":{"title":"Doing asynchronous calls using React hooks","date":"July 25, 2020","thumbnail":null}},"profileImage":{"childImageSharp":{"fixed":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGQABAAMBAQAAAAAAAAAAAAAAAAIDBAYF/8QAFwEAAwEAAAAAAAAAAAAAAAAAAAEDAv/aAAwDAQACEAMQAAAB0TwVp9GrYOVmWPQEbf/EABwQAAICAgMAAAAAAAAAAAAAAAEDAAIEIRESMf/aAAgBAQABBQIvvWmO+zJqMyNYzgtneHxI5iiRX//EABURAQEAAAAAAAAAAAAAAAAAAAEg/9oACAEDAQE/ASP/xAAXEQADAQAAAAAAAAAAAAAAAAAAARAR/9oACAECAQE/AcrP/8QAHRAAAgIBBQAAAAAAAAAAAAAAAAECEBETITFBgf/aAAgBAQAGPwJvSx6NSVOKWTfumSOT/8QAGRABAAMBAQAAAAAAAAAAAAAAAQARIUFR/9oACAEBAAE/IUjUdhgBTyX6mZQ4rEjfi/IFLId+2QdJQxVc/9oADAMBAAIAAwAAABDvwID/xAAYEQEAAwEAAAAAAAAAAAAAAAABABARMf/aAAgBAwEBPxACbTwgGT//xAAXEQADAQAAAAAAAAAAAAAAAAAAATER/9oACAECAQE/EG+Q0cZTP//EABwQAQEBAAIDAQAAAAAAAAAAAAERACExYXGx8P/aAAgBAQABPxBeIbQQ9ml2hsiD4zRIxwhUPmHfhIfRj6KPTO8B+4dTG8Tncd8pXrf/2Q==","width":27,"height":27,"src":"/static/a1888163d3c89ce7630686114b5da925/868a6/profile-pic-small.jpg","srcSet":"/static/a1888163d3c89ce7630686114b5da925/868a6/profile-pic-small.jpg 1x,\n/static/a1888163d3c89ce7630686114b5da925/b0637/profile-pic-small.jpg 1.5x,\n/static/a1888163d3c89ce7630686114b5da925/00b40/profile-pic-small.jpg 2x"}}}},"pageContext":{"slug":"/2020-07-25-sexy-async-code-without-await-a-first-look-into-the-project-loom-in-java/","previous":{"fields":{"slug":"/2019-10-27-doing-asynchronous-calls-using-react-hooks/"},"frontmatter":{"title":"Doing asynchronous calls using React hooks","date":"October 27, 2019"}},"next":null}},"staticQueryHashes":["63159454"]}